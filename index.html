<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISION - AI-Powered UI Replicator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: #0f1419;
            --secondary-bg: #1a1f2e;
            --card-bg: #252b3a;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
            --hover-bg: #374151;
            --success: #10b981;
            --error: #ef4444;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        [data-theme="light"] {
            --primary-bg: #f8fafc;
            --secondary-bg: #ffffff;
            --card-bg: #ffffff;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --hover-bg: #f1f5f9;
            --success: #10b981;
            --error: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Navigation */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            animation: slideDown 0.8s ease-out;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        /* Cool techy VISION icon */
        .logo-icon::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid currentColor;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 2s ease-in-out infinite;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: glow 2s ease-in-out infinite alternate;
        }

        .logo-icon .tech-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .logo-icon .tech-lines::before,
        .logo-icon .tech-lines::after {
            content: '';
            position: absolute;
            background: currentColor;
            opacity: 0.6;
        }

        .logo-icon .tech-lines::before {
            width: 12px;
            height: 1px;
            top: 8px;
            right: 4px;
            animation: scan1 3s ease-in-out infinite;
        }

        .logo-icon .tech-lines::after {
            width: 10px;
            height: 1px;
            bottom: 8px;
            left: 4px;
            animation: scan2 3s ease-in-out infinite 1.5s;
        }

        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .theme-toggle:hover {
            background: var(--hover-bg);
            transform: translateY(-1px);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 4rem 0 2rem;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Input Mode Tabs */
        .input-modes {
            display: flex;
            justify-content: center;
            margin: 3rem 0 2rem;
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        .mode-tabs {
            display: flex;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0.5rem;
        }

        .mode-tab {
            background: transparent;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mode-tab.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            transform: translateY(-1px);
        }

        .mode-tab:not(.active):hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }

        /* Input Sections */
        .input-section {
            display: none;
            animation: fadeInUp 1s ease-out;
        }

        .input-section.active {
            display: block;
        }

        /* Image Upload Section */
        .upload-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .upload-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-card:hover::before {
            opacity: 1;
        }

        .upload-card.drag-over {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2rem;
            color: white;
            animation: float 3s ease-in-out infinite;
        }

        .upload-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .upload-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .choose-file-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            padding: 0.75rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .choose-file-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .choose-file-btn:hover::before {
            left: 100%;
        }

        .choose-file-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        /* Text Input Section */
        .text-input-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .prompt-textarea {
            width: 100%;
            min-height: 150px;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: all 0.3s ease;
        }

        .prompt-textarea:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .prompt-textarea::placeholder {
            color: var(--text-muted);
        }

        /* Preview */
        .preview-container {
            margin-top: 2rem;
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
        }

        /* Submit Button */
        .submit-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
            min-width: 200px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .submit-btn .loading {
            display: none;
        }

        .submit-btn.loading .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        .submit-btn.loading .text {
            display: none;
        }

        /* Results Section */
        .results-section {
            display: none;
            margin-bottom: 2rem;
            animation: fadeInUp 1s ease-out;
        }

        .result-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .result-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-primary);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            background: var(--hover-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-btn:hover {
            background: var(--accent-primary);
            color: white;
            transform: translateY(-1px);
        }

        .code-container {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        pre[class*="language-"] {
            margin: 0;
            border-radius: 12px;
            max-height: 500px;
            overflow-y: auto;
        }

        /* Follow-up Section */
        .followup-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
            display: none;
        }

        .followup-section.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        .followup-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .followup-input {
            width: 100%;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .followup-input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .followup-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .followup-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .followup-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Conversation History */
        .conversation-history {
            margin-top: 2rem;
        }

        .conversation-item {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: var(--primary-bg);
            border-radius: 12px;
            border-left: 4px solid var(--accent-primary);
            animation: slideInLeft 0.5s ease-out;
        }

        .conversation-query {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .conversation-response {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .suggestions-list {
            list-style: none;
        }

        .suggestion-item {
            background: rgba(99, 102, 241, 0.1);
            border-left: 4px solid var(--accent-primary);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 0 12px 12px 0;
            animation: slideInLeft 0.5s ease-out;
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            transform: translateX(4px);
            background: rgba(99, 102, 241, 0.15);
        }

        .suggestion-item:nth-child(2) {
            animation-delay: 0.1s;
        }

        .suggestion-item:nth-child(3) {
            animation-delay: 0.2s;
        }

        .suggestion-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
        }

        /* Error Message */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: var(--error);
            margin-top: 1rem;
            display: none;
            animation: shake 0.5s ease-in-out;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 0;
            color: var(--text-muted);
            font-size: 0.875rem;
            border-top: 1px solid var(--border-color);
            margin-top: 4rem;
        }

        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            75% {
                transform: translateX(5px);
            }
        }

        /* Cool techy icon animations */
        @keyframes pulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0.7;
            }
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 5px currentColor;
            }
            100% {
                box-shadow: 0 0 15px currentColor, 0 0 25px currentColor;
            }
        }

        @keyframes scan1 {
            0%, 100% {
                opacity: 0.3;
                transform: scaleX(0.5);
            }
            50% {
                opacity: 1;
                transform: scaleX(1);
            }
        }

        @keyframes scan2 {
            0%, 100% {
                opacity: 0.3;
                transform: scaleX(0.8);
            }
            50% {
                opacity: 1;
                transform: scaleX(1);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .container {
                padding: 0 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .upload-card, .text-input-card {
                padding: 2rem;
            }

            .mode-tabs {
                flex-direction: column;
                width: 100%;
            }

            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <div class="logo-icon">
                <div class="tech-lines"></div>
            </div>
            VISION
        </div>
        <button class="theme-toggle" onclick="toggleTheme()">
            <i class="fas fa-moon" id="theme-icon"></i>
        </button>
    </nav>

    <div class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h1>VISION</h1>
            <p>Upload a screenshot or describe your UI idea to instantly generate production-ready HTML/CSS/JS code with proper image handling and expert UX suggestions.</p>
        </section>

        <!-- Input Mode Selection -->
        <div class="input-modes">
            <div class="mode-tabs">
                <button class="mode-tab active" onclick="switchMode('image')" id="imageTab">
                    <i class="fas fa-image"></i>
                    Screenshot to Code
                </button>
                <button class="mode-tab" onclick="switchMode('text')" id="textTab">
                    <i class="fas fa-keyboard"></i>
                    Text to Code
                </button>
            </div>
        </div>

        <!-- Image Upload Section -->
        <section class="input-section active" id="imageSection">
            <div class="upload-card" onclick="document.getElementById('imageInput').click()">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h2 class="upload-title">Upload UI Screenshot</h2>
                <p class="upload-subtitle">Drag & drop your image or click to browse files</p>
                
                <button class="choose-file-btn" type="button">
                    Choose File
                </button>
                
                <div style="margin: 2rem 0; color: var(--text-muted); font-size: 0.875rem;">
                    OR
                </div>
                
                <p style="color: var(--text-muted); font-size: 0.875rem;">Drag your image anywhere on this card</p>
                
                <input type="file" id="imageInput" accept="image/*">
            </div>
            
            <div class="preview-container" id="previewContainer">
                <img id="previewImage" class="preview-image" alt="Preview">
            </div>

            <div style="text-align: center;">
                <button class="submit-btn" id="submitBtn" onclick="analyzeImage()" disabled>
                    <i class="fas fa-spinner loading"></i>
                    <span class="text">Analyze UI Screenshot</span>
                </button>
            </div>
        </section>

        <!-- Text Input Section -->
        <section class="input-section" id="textSection">
            <div class="text-input-card">
                <h2 style="font-size: 1.75rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">
                    Describe Your UI
                </h2>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    Describe the user interface you want to create in detail. Include layout, colors, components, and functionality.
                </p>
                
                <textarea 
                    class="prompt-textarea" 
                    id="promptTextarea" 
                    placeholder="Example: Create a modern login form with a dark theme, glassmorphic design, email and password fields, a 'Remember me' checkbox, social login buttons for Google and GitHub, and a gradient submit button. Include proper form validation and responsive design."
                ></textarea>

                <div style="text-align: center;">
                    <button class="submit-btn" id="textSubmitBtn" onclick="generateFromText()">
                        <i class="fas fa-spinner loading"></i>
                        <span class="text">Generate UI Code</span>
                    </button>
                </div>
            </div>
        </section>

        <div class="error-message" id="errorMessage"></div>

        <!-- Results Section -->
        <section class="results-section" id="resultsSection">
            <div class="result-card">
                <div class="result-header">
                    <div class="result-title">
                        <i class="fas fa-code"></i>
                        Generated Code
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="copyCode()">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="action-btn" onclick="downloadCode()">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="action-btn" onclick="previewCode()">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                </div>
                <div class="code-container">
                    <pre><code class="language-html" id="generatedCode"></code></pre>
                </div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <div class="result-title">
                        <i class="fas fa-lightbulb"></i>
                        UX Suggestions
                    </div>
                </div>
                <ul class="suggestions-list" id="suggestionsList"></ul>
            </div>

            <!-- Follow-up Section -->
            <div class="followup-section" id="followupSection">
                <div class="followup-title">
                    <i class="fas fa-comments"></i>
                    Continue the conversation
                </div>
                <input 
                    type="text" 
                    class="followup-input" 
                    id="followupInput" 
                    placeholder="Ask for modifications, improvements, or questions about the code..."
                    onkeypress="handleFollowupKeyPress(event)"
                >
                <button class="followup-btn" id="followupBtn" onclick="sendFollowup()">
                    Send Query
                </button>

                <div class="conversation-history" id="conversationHistory"></div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>VISION © 2025 | Powered by GPT-4o Vision Support</p>
    </footer>

    <!-- Preview Modal -->
    <div id="previewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; padding: 2rem;">
        <div style="background: white; width: 100%; height: 100%; border-radius: 12px; position: relative;">
            <button onclick="closePreview()" style="position: absolute; top: 1rem; right: 1rem; background: #ef4444; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem;">×</button>
            <iframe id="previewFrame" style="width: 100%; height: 100%; border: none; border-radius: 12px;"></iframe>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        let uploadedImage = null;
        let generatedCode = '';
        let conversationContext = [];
        let currentMode = 'image';

        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.getAttribute('data-theme') === 'light') {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
            } else {
                body.setAttribute('data-theme', 'light');
                themeIcon.className = 'fas fa-sun';
            }
        }

        // Mode switching
        function switchMode(mode) {
            currentMode = mode;
            
            // Update tabs
            document.getElementById('imageTab').classList.toggle('active', mode === 'image');
            document.getElementById('textTab').classList.toggle('active', mode === 'text');
            
            // Update sections
            document.getElementById('imageSection').classList.toggle('active', mode === 'image');
            document.getElementById('textSection').classList.toggle('active', mode === 'text');
            
            // Hide results when switching modes
            document.getElementById('resultsSection').style.display = 'none';
        }

        // File upload handling
        const uploadCard = document.querySelector('.upload-card');
        const imageInput = document.getElementById('imageInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const submitBtn = document.getElementById('submitBtn');
        const errorMessage = document.getElementById('errorMessage');

        // Drag and drop functionality
        uploadCard.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadCard.classList.add('drag-over');
        });

        uploadCard.addEventListener('dragleave', (e) => {
            if (!uploadCard.contains(e.relatedTarget)) {
                uploadCard.classList.remove('drag-over');
            }
        });

        uploadCard.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadCard.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            if (!file.type.startsWith('image/')) {
                showError('Please select a valid image file.');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                showError('File size must be less than 10MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result.split(',')[1];
                previewImage.src = e.target.result;
                previewContainer.style.display = 'block';
                submitBtn.disabled = false;
                hideError();
            };
            reader.readAsDataURL(file);
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Enhanced API call for image analysis
        async function analyzeImage() {
            if (!uploadedImage) {
                showError('Please upload an image first.');
                return;
            }

            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            hideError();

            try {
                const response = await fetch("https://api.a4f.co/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer ddc-a4f-b6b0cdaee61c48a5af05b16ae38d4025"
                    },
                    body: JSON.stringify({
                        model: "provider-6/gpt-4o",
                        messages: [
                            {
                                role: "user",
                                content: [
                                    {
                                        type: "text",
                                        text: `Analyze this UI screenshot and generate complete, production-ready HTML/CSS/JS code. 

IMPORTANT REQUIREMENTS:
1. For any images in the UI, use placeholder.svg with appropriate dimensions (e.g., "/placeholder.svg?height=200&width=300")
2. Include ALL necessary CSS for styling, animations, and responsiveness
3. Make the code fully functional with proper JavaScript interactions
4. Use modern CSS features like flexbox, grid, and CSS variables
5. Include proper semantic HTML structure
6. Add hover effects and smooth transitions

Please provide your response in this exact format:

## HTML/CSS/JS Code
\`\`\`html
[Your complete HTML code with embedded CSS and JavaScript here - make it a complete, working webpage]
\`\`\`

## UX Suggestions
1. **[Suggestion Title]**: [Detailed explanation]
2. **[Suggestion Title]**: [Detailed explanation]
3. **[Suggestion Title]**: [Detailed explanation]

Make sure the generated code is pixel-perfect to the screenshot and includes all visual elements, proper spacing, colors, and functionality.`
                                    },
                                    {
                                        type: "image_url",
                                        image_url: {
                                            url: `data:image/png;base64,${uploadedImage}`
                                        }
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                const reply = data.choices[0].message.content;
                
                conversationContext = [
                    { role: "user", content: "Analyzed UI screenshot" },
                    { role: "assistant", content: reply }
                ];
                
                parseAndDisplayResults(reply);
                
            } catch (error) {
                console.error('Error:', error);
                showError('Failed to analyze the image. Please try again.');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }
        }

        // Text to code generation
        async function generateFromText() {
            const promptTextarea = document.getElementById('promptTextarea');
            const textSubmitBtn = document.getElementById('textSubmitBtn');
            const prompt = promptTextarea.value.trim();
            
            if (!prompt) {
                showError('Please enter a description of the UI you want to create.');
                return;
            }

            textSubmitBtn.classList.add('loading');
            textSubmitBtn.disabled = true;
            hideError();

            try {
                const response = await fetch("https://api.a4f.co/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer ddc-a4f-b6b0cdaee61c48a5af05b16ae38d4025"
                    },
                    body: JSON.stringify({
                        model: "provider-6/gpt-4o",
                        messages: [
                            {
                                role: "user",
                                content: `Create a complete, production-ready HTML/CSS/JS code based on this description: "${prompt}"

IMPORTANT REQUIREMENTS:
1. For any images needed, use placeholder.svg with appropriate dimensions (e.g., "/placeholder.svg?height=200&width=300")
2. Include ALL necessary CSS for styling, animations, and responsiveness
3. Make the code fully functional with proper JavaScript interactions
4. Use modern CSS features like flexbox, grid, and CSS variables
5. Include proper semantic HTML structure
6. Add hover effects and smooth transitions
7. Make it visually appealing with modern design principles

Please provide your response in this exact format:

## HTML/CSS/JS Code
\`\`\`html
[Your complete HTML code with embedded CSS and JavaScript here - make it a complete, working webpage]
\`\`\`

## UX Suggestions
1. **[Suggestion Title]**: [Detailed explanation]
2. **[Suggestion Title]**: [Detailed explanation]
3. **[Suggestion Title]**: [Detailed explanation]

Create a beautiful, modern, and fully functional UI that matches the description perfectly.`
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                const reply = data.choices[0].message.content;
                
                conversationContext = [
                    { role: "user", content: prompt },
                    { role: "assistant", content: reply }
                ];
                
                parseAndDisplayResults(reply);
                
            } catch (error) {
                console.error('Error:', error);
                showError('Failed to generate the code. Please try again.');
            } finally {
                textSubmitBtn.classList.remove('loading');
                textSubmitBtn.disabled = false;
            }
        }

        function parseAndDisplayResults(response) {
            const resultsSection = document.getElementById('resultsSection');
            const generatedCodeElement = document.getElementById('generatedCode');
            const suggestionsList = document.getElementById('suggestionsList');
            const followupSection = document.getElementById('followupSection');

            // Extract code block
            const codeMatch = response.match(/\`\`\`html\n([\s\S]*?)\n\`\`\`/);
            if (codeMatch) {
                generatedCode = codeMatch[1];
                generatedCodeElement.textContent = generatedCode;
                Prism.highlightElement(generatedCodeElement);
            } else {
                generatedCodeElement.textContent = 'No code block found in the response.';
            }

            // Extract UX suggestions
            const suggestionsMatch = response.match(/## UX Suggestions\n([\s\S]*?)(?=\n##|$)/);
            if (suggestionsMatch) {
                const suggestions = suggestionsMatch[1].match(/\d+\.\s\*\*(.*?)\*\*:\s(.*?)(?=\n\d+\.|$)/g);
                
                suggestionsList.innerHTML = '';
                if (suggestions) {
                    suggestions.forEach((suggestion, index) => {
                        const match = suggestion.match(/\d+\.\s\*\*(.*?)\*\*:\s(.*)/);
                        if (match) {
                            const title = match[1];
                            const description = match[2];
                            
                            const li = document.createElement('li');
                            li.className = 'suggestion-item';
                            li.innerHTML = `
                                <div class="suggestion-title">
                                    <i class="fas fa-star"></i>
                                    ${title}
                                </div>
                                <div>${description}</div>
                            `;
                            suggestionsList.appendChild(li);
                        }
                    });
                }
            }

            resultsSection.style.display = 'block';
            followupSection.classList.add('active');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Action buttons
        function copyCode() {
            navigator.clipboard.writeText(generatedCode).then(() => {
                const copyBtn = document.querySelector('.action-btn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                copyBtn.style.background = 'var(--success)';
                copyBtn.style.color = 'white';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = '';
                    copyBtn.style.color = '';
                }, 2000);
            });
        }

        function downloadCode() {
            const blob = new Blob([generatedCode], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vision-generated-ui.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function previewCode() {
            const modal = document.getElementById('previewModal');
            const frame = document.getElementById('previewFrame');
            
            const blob = new Blob([generatedCode], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            frame.src = url;
            modal.style.display = 'block';
        }

        function closePreview() {
            const modal = document.getElementById('previewModal');
            const frame = document.getElementById('previewFrame');
            
            modal.style.display = 'none';
            URL.revokeObjectURL(frame.src);
            frame.src = '';
        }

        // Follow-up functionality
        function handleFollowupKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendFollowup();
            }
        }

        async function sendFollowup() {
            const followupInput = document.getElementById('followupInput');
            const followupBtn = document.getElementById('followupBtn');
            const query = followupInput.value.trim();
            
            if (!query) return;
            
            followupBtn.disabled = true;
            followupInput.value = '';
            
            // Add to conversation history display
            addToConversationHistory(query, 'user');
            
            try {
                const response = await fetch("https://api.a4f.co/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer ddc-a4f-b6b0cdaee61c48a5af05b16ae38d4025"
                    },
                    body: JSON.stringify({
                        model: "provider-6/gpt-4o",
                        messages: [
                            ...conversationContext,
                            {
                                role: "user",
                                content: `Based on the previously generated code, please help with this request: "${query}". 

If you're providing updated code, please format it as:
## Updated Code
\`\`\`html
[Updated HTML code here]
\`\`\`

Otherwise, provide a helpful response about the code or suggestions.`
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                const reply = data.choices[0].message.content;
                
                // Add to conversation context
                conversationContext.push(
                    { role: "user", content: query },
                    { role: "assistant", content: reply }
                );
                
                // Add to conversation history display
                addToConversationHistory(reply, 'assistant');
                
                // Check if there's updated code
                const codeMatch = reply.match(/\`\`\`html\n([\s\S]*?)\n\`\`\`/);
                if (codeMatch) {
                    generatedCode = codeMatch[1];
                    const generatedCodeElement = document.getElementById('generatedCode');
                    generatedCodeElement.textContent = generatedCode;
                    Prism.highlightElement(generatedCodeElement);
                }
                
            } catch (error) {
                console.error('Follow-up error:', error);
                addToConversationHistory('Sorry, I encountered an error. Please try again.', 'assistant');
            } finally {
                followupBtn.disabled = false;
            }
        }

        function addToConversationHistory(content, sender) {
            const conversationHistory = document.getElementById('conversationHistory');
            const item = document.createElement('div');
            item.className = 'conversation-item';
            
            if (sender === 'user') {
                item.innerHTML = `
                    <div class="conversation-query">You asked:</div>
                    <div class="conversation-response">${content}</div>
                `;
            } else {
                item.innerHTML = `
                    <div class="conversation-query">AI Response:</div>
                    <div class="conversation-response">${content}</div>
                `;
            }
            
            conversationHistory.appendChild(item);
            item.scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize theme
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
            document.body.setAttribute('data-theme', 'light');
            document.getElementById('theme-icon').className = 'fas fa-sun';
        }
    </script>

<!-- Floating Chat Icon -->
<div id="chat-toggle-btn" onclick="toggleChatIframe()" style="position:fixed; bottom:20px; right:20px; background:#0d6efd; color:white; width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer; z-index:9999;">
  💬
</div>

<!-- Chatbot Iframe Popup -->
<iframe id="chatbot-frame" src="https://oasis-parzival.github.io/intelligent-assistant-manager/" style="position:fixed; bottom:90px; right:20px; width:350px; height:500px; border:none; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.3); display:none; z-index:9998;"></iframe>

<script>
  function toggleChatIframe() {
    const frame = document.getElementById("chatbot-frame");
    frame.style.display = frame.style.display === "none" ? "block" : "none";
  }
</script>

</body>
</html>